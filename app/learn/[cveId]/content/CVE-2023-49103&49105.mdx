# 취약점 개요

## 📋 설명

ownCloud는 파일 공유 및 협업을 제공하는 오픈소스 웹 애플리케이션입니다.

GraphAPI 테스트 파일 노출(CVE-2023-49103)과 WebDAV 서명 우회(CVE-2023-49105)로 인해 공격자가 인증 없이 ownCloud 서버 및 외부 연계 리소스를 장악할 수 있습니다.

## ⚠️ 왜 위험한가?

**낮은 복잡도**: 인증 불필요 / 단순 HTTP 요청만으로 공격 성공

**높은 영향도**: Credential 노출 + 파일시스템 장악

**OSINT 결합**: Shodan에 ownCloud 서버 다수 노출 → 자동화 공격 쉬움

**확장 가능**: AWS·DB·SMTP 등 외부 서비스까지 털릴 수 있음

---

## 🧠 CVE-2023-49103 — GraphAPI 정보 노출 취약점

- `GetPhpInfo.php` 테스트 파일이 Docker 이미지에 그대로 포함됨

- `.css`, `.js`, `.html`, `.svg` 등 확장자 우회로 접근 가능

- PHPInfo 페이지에서 AWS Key, DB Password, SMTP Credential 등 전체 환경 변수가 노출됨

- 인증 없이 ownCloud 및 외부 클라우드 리소스 장악 가능

## 🧠 CVE-2023-49105 — WebDAV 인증 우회 취약점

- WebDAV API에서 `OC-Signature`, `OC-Credential` 검증이 불완전

- 공격자는 임의로 조작한 서명 값을 넣어 WebDAV 요청을 인증된 요청처럼 보이게 만듦

- 결과적으로 파일 읽기 / 탐색 / 삭제까지 가능

- ownCloud 파일 시스템 전체 장악

---

# 공격 시나리오

**Step 1. OSINT 기반 ownCloud 서버 탐색**

Shodan / Censys 등으로 노출된 ownCloud 인스턴스 수집

**Step 2. 정보 노출 공격 (CVE-2023-49103)**

```bash
curl -i "http://victim/app/graphapi/.../GetPhpInfo.php/.css"
```

→ 환경 변수에서 AWS Key, DB Password 등 민감 정보 노출

**Step 3. 인증 우회 공격 (CVE-2023-49105)**

```bash
curl "http://victim/remote.php/dav/files/user/Documents?OC-Credential=user&OC-Date=2024-12-20&OC-Verb=GET&OC-Signature=<hash>"
```

→ 인증 우회 성공 → 파일 읽기/삭제/탐색 가능

**Step 4. 외부 확장 공격**

- DB 접속 정보 탈취

- AWS Key로 S3·IAM 접근

- SMTP Credential 탈취 후 피싱 메일 발송

- 내부망 Pivoting

---

# 실습 환경 구성

| 역할   | 구성                        | IP        |
| ------ | --------------------------- | --------- |
| 피해자 | ownCloud/server 10.12.1 (Docker) | 10.0.0.x |
| 공격자 | Ubuntu / Kali Linux         | 10.0.0.y |

## 사전 준비사항

- Docker, curl, Python
- WebDAV 구조 이해
- OSINT 스킬

---

# 취약점 상세 분석

## ✔ CVE-2023-49103 — PHPInfo 확장자 우회 노출

- .htaccess 규칙 부재

- 테스트용 PHP 파일 제거 누락

- 우회 확장자(.css 등)로 PHP 코드 실행됨

→ 환경 변수 전체 노출

## ✔ CVE-2023-49105 — WebDAV 서명 검증 우회

- 서명 검증 로직 불완전

- 조작된 OC-* 파라미터로 인증 우회

→ 파일 시스템 전체 조작 가능

---

# 패치 정보

## 안전한 버전

- **ownCloud 최신 버전** (즉시 업데이트 권장)

## 공통 조치

- graphapi 테스트 파일 즉시 삭제
- ownCloud 최신 버전 업데이트
- OWNCLOUD_TRUSTED_DOMAINS 최소화
- WebDAV API 로깅·검증 강화
- 모든 외부 Credential 재발급

---

# 학습 포인트 (CVE 학습자용 요약)

## 🔹 테스트 파일 방치의 위험성

운영 환경에 남아 있는 디버그 파일은 전체 Credential 노출 리스크로 직결됨.

## 🔹 확장자 우회 공격 패턴

웹서버 확장자 필터링 허점을 이용해 .css 등으로 실행 우회 가능.

## 🔹 API 서명 검증의 중요성

서명 검증 로직이 조금만 허술해도 전체 인증 체계가 붕괴될 수 있음.

## 🔹 OSINT 기반 공격 실전성

공격자는 Shodan 검색만으로 취약한 서버를 대량으로 식별가능.

---

# 참고 자료

- [ownCloud Security Advisories](https://owncloud.com/security-advisories/)

- [Ambionics PoC](https://www.ambionics.io/blog/owncloud-graphapi-exposure)

- [SK쉴더스 CVE 보고서](https://www.skshieldus.com/)

