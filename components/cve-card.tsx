"use client"

import { useRouter, useSearchParams } from "next/navigation"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { SeverityBadge } from "@/components/severity-badge"
import type { CVEItem } from "@/lib/mock-data"
import { CheckCircle } from "lucide-react"
import { cn } from "@/lib/utils"

interface CVECardProps {
  cve: CVEItem
  showLabButton?: boolean
  isCompleted?: boolean
}

export function CVECard({ cve, showLabButton = true, isCompleted = false }: CVECardProps) {
  const router = useRouter()
  const searchParams = useSearchParams()

  const handleCardClick = () => {
    // 현재 페이지 번호를 쿼리 파라미터로 전달
    const currentPage = searchParams?.get('page') || '1'
    router.push(`/learn/${cve.id}?fromPage=${currentPage}`)
  }

  return (
    <Card 
      onClick={handleCardClick}
      className={cn(
        "bg-white hover:shadow-lg transition-all duration-300 border-none shadow-sm ring-1 ring-zinc-900/5 cursor-pointer",
        isCompleted && "ring-2 ring-emerald-400 hover:ring-emerald-500"
      )}
    >
      {isCompleted && (
        <div className="absolute -top-2 -right-2 z-10 bg-white rounded-full">
          <CheckCircle className="h-6 w-6 text-emerald-500 fill-white" />
        </div>
      )}
      
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between gap-2">
          <CardTitle className="text-lg text-zinc-900">{cve.id}</CardTitle>
          <SeverityBadge score={cve.cvssScore} level={cve.severity} />
        </div>
      </CardHeader>
      
      <CardContent className="space-y-3">
        {/* 태그 (Domain & OS) */}
        <div className="flex flex-wrap gap-2">
          {cve.domain && (
            <Badge variant="secondary" className="text-xs bg-blue-50 text-blue-600 hover:bg-blue-100 border-none">
              {cve.domain}
            </Badge>
          )}
          {cve.os && (
            <Badge variant="secondary" className="text-xs bg-blue-50 text-blue-600 hover:bg-blue-100 border-none">
              {cve.os}
            </Badge>
          )}
        </div>

        {/* 설명 */}
        <p className="text-sm text-zinc-600 line-clamp-3">{cve.summary}</p>
      </CardContent>
    </Card>
  )
}
